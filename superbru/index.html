<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Dan Travers - SuperBru</title>
    <meta name="description" content="Predict football match scores.">
    <meta name="author" content="Dan Travers">
    <link rel="stylesheet" type="text/css" href="/style.css">
    <link rel="icon" type="image/png" href="/dicon.png">
</head>
<body>
    <header>
        <h1><a href="/" class="home-link">Dan Travers</a></h1>
    </header>

    <nav>
        <a href="/writing/">Writing</a>
        <a href="/superbru/" class="active">SuperBru</a>
        <a href="/fpl/">FPL</a>
    </nav>

    <article>
        <h2>SuperBru</h2>
        <p>Calculate the scoreline with the highest expected SuperBru points.</p>

        <div class="football-score-container">
            <!-- Home Team Selection -->
            <div class="team-selection">
                <label for="team1">Home team:</label>
                <select id="team1">
                    <option value="">-- Choose a team --</option>
                    <option value="Arsenal">Arsenal</option>
                    <option value="Aston Villa">Aston Villa</option>
                    <option value="Bournemouth">Bournemouth</option>
                    <option value="Brentford">Brentford</option>
                    <option value="Brighton">Brighton</option>
                    <option value="Chelsea">Chelsea</option>
                    <option value="Crystal Palace">Crystal Palace</option>
                    <option value="Everton">Everton</option>
                    <option value="Fulham">Fulham</option>
                    <option value="Ipswich">Ipswich</option>
                    <option value="Leicester">Leicester</option>
                    <option value="Liverpool">Liverpool</option>
                    <option value="Manchester City">Manchester City</option>
                    <option value="Manchester United">Manchester United</option>
                    <option value="Newcastle United">Newcastle United</option>
                    <option value="Nottingham Forest">Nottingham Forest</option>
                    <option value="Southampton">Southampton</option>
                    <option value="Tottenham">Tottenham</option>
                    <option value="West Ham">West Ham</option>
                    <option value="Wolverhampton Wanderers">Wolverhampton Wanderers</option>                    
                </select>
            </div>

            <!-- Away Team Selection -->
            <div class="team-selection">
                <label for="team2">Away team:</label>
                <select id="team2">
                    <option value="">-- Choose a team --</option>
                    <option value="Arsenal">Arsenal</option>
                    <option value="Aston Villa">Aston Villa</option>
                    <option value="Bournemouth">Bournemouth</option>
                    <option value="Brentford">Brentford</option>
                    <option value="Brighton">Brighton</option>
                    <option value="Chelsea">Chelsea</option>
                    <option value="Crystal Palace">Crystal Palace</option>
                    <option value="Everton">Everton</option>
                    <option value="Fulham">Fulham</option>
                    <option value="Ipswich">Ipswich</option>
                    <option value="Leicester">Leicester</option>
                    <option value="Liverpool">Liverpool</option>
                    <option value="Manchester City">Manchester City</option>
                    <option value="Manchester United">Manchester United</option>
                    <option value="Newcastle United">Newcastle United</option>
                    <option value="Nottingham Forest">Nottingham Forest</option>
                    <option value="Southampton">Southampton</option>
                    <option value="Tottenham">Tottenham</option>
                    <option value="West Ham">West Ham</option>
                    <option value="Wolverhampton Wanderers">Wolverhampton Wanderers</option>
                </select>
            </div>

            <!-- Predict Button -->
            <div class="predict-container">
                <button id="predict-button">Calculate</button>
            </div>
        </div>

        <p id="result" class="result-message"></p>

        <table id="prediction-table" style="display:none;">
            <tr>
                <th>Predicted Goals (Home)</th>
                <th>Predicted Goals (Away)</th>
                <th>Most Likely Score</th>
                <th>Best SuperBru Prediction</th>
            </tr>
            <tr>
                <td id="home-goals"></td>
                <td id="away-goals"></td>
                <td id="likely-score"></td>
                <td id="best-prediction"></td>
            </tr>
        </table>
    </article>

    <script>
        // Configuration
        const API_URL = 'https://backend-agu8.onrender.com'; // Updated to use your hosted backend

        // Helper function to show error messages
        function showError(message) {
            const resultMessage = document.getElementById('result');
            resultMessage.textContent = message;
        }

        // Helper function to reset the display
        function resetDisplay() {
            const resultMessage = document.getElementById('result');
            const predictionTable = document.getElementById('prediction-table');
            resultMessage.textContent = '';
            resultMessage.style.color = '#007bff'; // Reset to default blue color
            predictionTable.style.display = 'none';
        }

        // Initialize the calculate button functionality
        document.getElementById('predict-button').addEventListener('click', async function() {
            const team1 = document.getElementById('team1').value;
            const team2 = document.getElementById('team2').value;
            const resultMessage = document.getElementById('result');
            const predictionTable = document.getElementById('prediction-table');

            // Reset display
            resetDisplay();

            // Validate selections
            if (!team1 || !team2) {
                showError('Please select both teams');
                return;
            }

            if (team1 === team2) {
                showError('Please select different teams');
                return;
            }

            // Show loading state
            resultMessage.textContent = 'Calculating...';

            try {
                const response = await fetch(`${API_URL}/predict`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ team1, team2 })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                // Update table cells
                document.getElementById('home-goals').textContent = data['Predicted Goals (Home)'];
                document.getElementById('away-goals').textContent = data['Predicted Goals (Away)'];
                document.getElementById('likely-score').textContent = data['Most Likely Score'];
                document.getElementById('best-prediction').textContent = data['Best SuperBru Prediction'];

                // Show the table and clear the loading message
                predictionTable.style.display = 'table';
                resultMessage.textContent = '';

            } catch (error) {
                console.error('Error:', error);
                showError('Error calculating prediction. Please try again.');
            }
        });

        // Add event listeners for team selection to clear error messages
        document.getElementById('team1').addEventListener('change', resetDisplay);
        document.getElementById('team2').addEventListener('change', resetDisplay);
    </script>
</body>
</html>