<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">

    <title>Dan Travers - SuperBru</title>
    <meta name="description" content="Predict football match scores.">
    <meta name="author" content="Dan Travers">
    <link rel="stylesheet" type="text/css" href="/style.css">
    <link rel="icon" type="image/png" href="/dicon.png">
  </head>
  <body>

    <!-- Header -->
    <header>
        <h1><a href="/" class="home-link">Dan Travers</a></h1>
    </header>

    <!-- Navigation -->
    <nav>
        <a href="/writing/">Writing</a>
        <a href="/superbru/" class="active">SuperBru</a>
        <a href="/fpl/">FPL</a>
    </nav>
    
    <!-- Main Content -->
    <article>
      <h2>SuperBru</h2>
      <p>Calculate the scoreline with the highest expected SuperBru points.</p>

      <!-- Team Selection UI -->
      <div class="football-score-container">
          <div class="team-selection">
              <label for="team1">Home team:</label>
              <select id="team1">
                <option value="">-- Choose a team --</option>
                <option value="Arsenal">Arsenal</option>
                <option value="Aston Villa">Aston Villa</option>
                <option value="Bournemouth">Bournemouth</option>
                <option value="Brentford">Brentford</option>
                <option value="Brighton">Brighton</option>
                <option value="Chelsea">Chelsea</option>
                <option value="Crystal Palace">Crystal Palace</option>
                <option value="Everton">Everton</option>
                <option value="Fulham">Fulham</option>
                <option value="Ipswich">Ipswich</option>
                <option value="Leicester">Leicester</option>
                <option value="Liverpool">Liverpool</option>
                <option value="Manchester City">Manchester City</option>
                <option value="Manchester United">Manchester United</option>
                <option value="Newcastle United">Newcastle United</option>
                <option value="Nottingham Forest">Nottingham Forest</option>
                <option value="Southampton">Southampton</option>
                <option value="Tottenham">Tottenham</option>
                <option value="West Ham">West Ham</option>
                <option value="Wolverhampton Wanderers">Wolverhampton Wanderers</option>
              </select>
          </div>

          <div class="team-selection">
              <label for="team2">Away team:</label>
              <select id="team2">
                <option value="">-- Choose a team --</option>
                <option value="Arsenal">Arsenal</option>
                <option value="Aston Villa">Aston Villa</option>
                <option value="Bournemouth">Bournemouth</option>
                <option value="Brentford">Brentford</option>
                <option value="Brighton">Brighton</option>
                <option value="Chelsea">Chelsea</option>
                <option value="Crystal Palace">Crystal Palace</option>
                <option value="Everton">Everton</option>
                <option value="Fulham">Fulham</option>
                <option value="Ipswich">Ipswich</option>
                <option value="Leicester">Leicester</option>
                <option value="Liverpool">Liverpool</option>
                <option value="Manchester City">Manchester City</option>
                <option value="Manchester United">Manchester United</option>
                <option value="Newcastle United">Newcastle United</option>
                <option value="Nottingham Forest">Nottingham Forest</option>
                <option value="Southampton">Southampton</option>
                <option value="Tottenham">Tottenham</option>
                <option value="West Ham">West Ham</option>
                <option value="Wolverhampton Wanderers">Wolverhampton Wanderers</option>                
              </select>
          </div>

          <div class="predict-container">
              <button id="predict-button">Calculate</button>
          </div>
      </div>

      <!-- Prediction Result Table -->
      <div id="result-container" class="result-container">
          <table id="result-table" class="styled-table" style="display: none;">
              <thead>
                  <tr>
                      <th>Metric</th>
                      <th>Value</th>
                  </tr>
              </thead>
              <tbody id="result-body">
                  <!-- Results will be dynamically inserted here -->
              </tbody>
          </table>
      </div>

    </article>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const predictButton = document.getElementById("predict-button");
            const team1Select = document.getElementById("team1");
            const team2Select = document.getElementById("team2");
            const resultTable = document.getElementById("result-table");
            const resultBody = document.getElementById("result-body");

            predictButton.addEventListener("click", async function () {
                const team1 = team1Select.value;
                const team2 = team2Select.value;

                if (!team1 || !team2) {
                    alert("Please select both teams.");
                    return;
                }

                if (team1 === team2) {
                    alert("Teams must be different.");
                    return;
                }

                resultBody.innerHTML = `<tr><td colspan="2">Calculating...</td></tr>`; 
                resultTable.style.display = "table";

                try {
                    const response = await fetch("https://backend-agu8.onrender.com/predict", {
                        method: "POST",
                        headers: { 
                            "Content-Type": "application/json",
                            "Accept": "application/json"
                        },
                        body: JSON.stringify({ team1, team2 }),
                    });

                    if (!response.ok) {
                        throw new Error(`Server error! Status: ${response.status}`);
                    }

                    const data = await response.json();

                    if (data["Predicted Goals (Home)"] !== undefined) {
                        resultBody.innerHTML = `
                            <tr><td><strong>Home Predicted Goals</strong></td><td>${data["Predicted Goals (Home)"]}</td></tr>
                            <tr><td><strong>Away Predicted Goals</strong></td><td>${data["Predicted Goals (Away)"]}</td></tr>
                            <tr><td><strong>Most Likely Score</strong></td><td>${data["Most Likely Score"]}</td></tr>
                            <tr><td><strong>Best SuperBru Prediction</strong></td><td>${data["Best SuperBru Prediction"]}</td></tr>
                        `;
                    } else {
                        resultBody.innerHTML = `<tr><td colspan="2">Error: Unexpected response format.</td></tr>`;
                    }

                } catch (error) {
                    console.error("Error fetching prediction:", error);
                    resultBody.innerHTML = `<tr><td colspan="2">Error fetching prediction.</td></tr>`;
                }
            });
        });
    </script>

  </body>
</html>
